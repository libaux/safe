import{_ as e,Y as a,a as t,n,r,b as i,c as s,w as l,i as o,d,e as u,f as c,j as p,o as m,l as g,m as f,t as h,p as _,q as b,F as y,I as x,u as C}from"./index-nI17xpur.js";import{_ as w}from"./uni-stat-breadcrumb.CcLttN9R.js";import{_ as z}from"./uni-dateformat.XhJvGPjv.js";import{_ as j}from"./uni-pagination.CVUxf30B.js";import{_ as D}from"./unicloud-db.C5sq8uaK.js";const V=a.database(),$=["user_id.username","user_id.nickname","type","ip"];const k=e({data:()=>({collectionList:[V.collection("uni-id-log").field("type, ip, create_date, user_id").getTemp(),V.collection("libraux-users").field("_id, username,nickname").getTemp()],query:"",where:"",orderby:"create_date desc",options:{pageSize:20,pageCurrent:1}}),methods:{getWhere(){const e=this.query.trim();if(!e)return"";let a;try{a=new RegExp(e,"i")}catch(n){return void t({title:"请勿输入等不满足正则格式的符号",icon:"none"})}return $.map((e=>a+".test("+e+")")).join(" || ")},search(){const e=this.getWhere(),a=e===this.where;this.where=e,a&&this.loadData()},loadData(e=!0){this.$refs.udb.loadData({clear:e})},onPageChanged(e){this.$refs.udb.loadData({current:e.current})},navigateTo(e){n({url:e,events:{refreshData:()=>{this.loadData()}}})},selectedItems(){var e=this.$refs.udb.dataList;return this.selectedIndexs.map((a=>e[a]._id))},delTable(){this.$refs.udb.remove(this.selectedItems())},selectionChange(e){this.selectedIndexs=e.detail.index},confirmDelete(e){this.$refs.udb.remove(e)}}},[["render",function(e,a,t,n,V,$){const k=r(i("uni-stat-breadcrumb"),w),q=x,v=C,I=o,T=r(i("uni-th"),d),L=r(i("uni-tr"),u),P=r(i("uni-td"),c),U=r(i("uni-dateformat"),z),S=r(i("uni-table"),p),W=r(i("uni-pagination"),j),E=r(i("unicloud-db"),D);return m(),s(I,null,{default:l((()=>[g(I,{class:"uni-header"},{default:l((()=>[g(k,{class:"uni-stat-breadcrumb-on-phone"}),g(I,{class:"uni-group"},{default:l((()=>[g(q,{class:"uni-search",type:"text",modelValue:V.query,"onUpdate:modelValue":a[0]||(a[0]=e=>V.query=e),onConfirm:$.search,placeholder:e.$t("common.placeholder.query")},null,8,["modelValue","onConfirm","placeholder"]),g(v,{class:"uni-button hide-on-phone",type:"default",size:"mini",onClick:$.search},{default:l((()=>[f(h(e.$t("common.button.search")),1)])),_:1},8,["onClick"])])),_:1})])),_:1}),g(I,{class:"uni-container"},{default:l((()=>[g(E,{ref:"udb",collection:V.collectionList,options:V.options,where:V.where,"page-data":"replace",orderby:V.orderby,getcount:!0,"page-size":V.options.pageSize,"page-current":V.options.pageCurrent},{default:l((({data:e,pagination:a,loading:t,error:n})=>[g(S,{loading:t,emptyText:n.message||"没有更多数据",border:"",stripe:""},{default:l((()=>[g(L,null,{default:l((()=>[g(T,{align:"center"},{default:l((()=>[f("序号")])),_:1}),g(T,{align:"center"},{default:l((()=>[f("用户名")])),_:1}),g(T,{align:"center"},{default:l((()=>[f("昵称")])),_:1}),g(T,{align:"center"},{default:l((()=>[f("内容")])),_:1}),g(T,{align:"center"},{default:l((()=>[f("IP")])),_:1}),g(T,{align:"center"},{default:l((()=>[f("时间")])),_:1})])),_:1}),(m(!0),_(y,null,b(e,((e,t)=>(m(),s(L,{key:t},{default:l((()=>[g(P,{align:"center"},{default:l((()=>[f(h((a.current-1)*a.size+(t+1)),1)])),_:2},1024),g(P,{align:"center"},{default:l((()=>[f(h(e.user_id[0]&&e.user_id[0].username||"-"),1)])),_:2},1024),g(P,{align:"center"},{default:l((()=>[f(h(e.user_id[0]&&e.user_id[0].nickname||"-"),1)])),_:2},1024),g(P,{align:"center"},{default:l((()=>[f(h(e.type),1)])),_:2},1024),g(P,{align:"center"},{default:l((()=>[f(h(e.ip),1)])),_:2},1024),g(P,{align:"center"},{default:l((()=>[g(U,{date:e.create_date,threshold:[0,0]},null,8,["date"])])),_:2},1024)])),_:2},1024)))),128))])),_:2},1032,["loading","emptyText"]),g(I,{class:"uni-pagination-box"},{default:l((()=>[g(W,{"show-icon":"","page-size":a.size,modelValue:a.current,"onUpdate:modelValue":e=>a.current=e,total:a.count,onChange:$.onPageChanged},null,8,["page-size","modelValue","onUpdate:modelValue","total","onChange"])])),_:2},1024)])),_:1},8,["collection","options","where","orderby","page-size","page-current"])])),_:1})])),_:1})}]]);export{k as default};
