import{_ as e,V as t,n as a,r as i,b as n,c as s,w as r,i as l,d as o,e as d,f as c,j as u,o as h,l as p,m as g,p as m,q as f,F as b,I as y,u as _,t as C}from"./index-BdDI6p4_.js";import{_ as x}from"./uni-stat-breadcrumb.CDsItGfh.js";import{_ as z}from"./download-excel.CU7a5LHn.js";import{_ as S}from"./uni-tag.DLpztVWK.js";import{_ as k}from"./uni-dateformat.Dpn8wxxF.js";import{_ as w}from"./uni-pagination.GfsLFm8f.js";import{_ as $}from"./unicloud-db.2xOvspzz.js";import{_ as j}from"./batch-sms.BDBiLVEO.js";import{e as D,f as v}from"./uni-id-tag.B4DgDmWM.js";import"./uni-data-select.B45eKRSr.js";import"./uni-forms-item._y2BL_uA.js";import"./uni-easyinput.WKvxAjIR.js";import"./uni-forms.VaLhD47k.js";const T=t.database(),I=[],E={ascending:"asc",descending:"desc"};const V=e({data:()=>({query:"",where:"",orderby:"",orderByFieldName:"",selectedIndexs:[],options:{pageSize:20,pageCurrent:1,filterData:{},...D},imageStyles:{width:64,height:64},exportExcel:{filename:"uni-id-tag.xls",type:"xls",fields:{"标签的tagid":"tagid","标签名称":"name","标签描述":"description"}},exportExcelData:[]}),onLoad(){this._filter={}},onReady(){this.$refs.udb.loadData()},computed:{smsReceiver(){if(this.selectedIndexs.length){var e=this.$refs.udb.dataList;return this.selectedIndexs.map((t=>e[t].tagid))}}},methods:{onqueryload(e){this.exportExcelData=e},changeSize(e){this.options.pageSize=e,this.options.pageCurrent=1,this.$nextTick((()=>{this.loadData()}))},getWhere(){const e=this.query.trim();if(!e)return"";const t=new RegExp(e,"i");return I.map((e=>t+".test("+e+")")).join(" || ")},search(){const e=this.getWhere();this.where=e,this.$nextTick((()=>{this.loadData()}))},loadData(e=!0){this.$refs.udb.loadData({clear:e})},onPageChanged(e){this.selectedIndexs.length=0,this.$refs.table.clearSelection(),this.$refs.udb.loadData({current:e.current})},navigateTo(e,t){a({url:e,events:{refreshData:()=>{this.loadData(t)}}})},selectedItems(){var e=this.$refs.udb.dataList;return this.selectedIndexs.map((t=>e[t]._id))},delTable(){this.$refs.udb.remove(this.selectedItems(),{success:e=>{this.$refs.table.clearSelection()}})},selectionChange(e){this.selectedIndexs=e.detail.index},confirmDelete(e){this.$refs.udb.remove(e,{success:e=>{this.$refs.table.clearSelection()}})},sortChange(e,t){this.orderByFieldName=t,e.order?this.orderby=t+" "+E[e.order]:this.orderby="",this.$refs.table.clearSelection(),this.$nextTick((()=>{this.$refs.udb.loadData()}))},filterChange(e,t){this._filter[t]={type:e.filterType,value:e.filter};let a=v(this._filter,T.command);Object.keys(a).length?this.where=a:this.where="",this.$nextTick((()=>{this.$refs.udb.loadData()}))}}},[["render",function(e,t,a,D,v,T){const I=i(n("uni-stat-breadcrumb"),x),E=y,V=_,q=i(n("download-excel"),z),F=l,L=i(n("uni-th"),o),P=i(n("uni-tr"),d),R=i(n("uni-td"),c),U=i(n("uni-tag"),S),B=i(n("uni-dateformat"),k),N=i(n("uni-table"),u),W=i(n("uni-pagination"),w),K=i(n("unicloud-db"),$),O=i(n("batch-sms"),j);return h(),s(F,{class:"fix-top-window"},{default:r((()=>[p(F,{class:"uni-header"},{default:r((()=>[p(I,{class:"uni-stat-breadcrumb-on-phone"}),p(F,{class:"uni-group"},{default:r((()=>[p(E,{class:"uni-search",type:"text",modelValue:v.query,"onUpdate:modelValue":t[0]||(t[0]=e=>v.query=e),onConfirm:T.search,placeholder:"请输入搜索内容"},null,8,["modelValue","onConfirm"]),p(V,{class:"uni-button hide-on-phone",type:"default",size:"mini",onClick:T.search},{default:r((()=>[g("搜索")])),_:1},8,["onClick"]),p(V,{class:"uni-button",type:"primary",size:"mini",onClick:t[1]||(t[1]=e=>T.navigateTo("./add"))},{default:r((()=>[g("新增")])),_:1}),p(V,{class:"uni-button",type:"warn",size:"mini",disabled:!v.selectedIndexs.length,onClick:T.delTable},{default:r((()=>[g("批量删除")])),_:1},8,["disabled","onClick"]),p(q,{class:"hide-on-phone",fields:v.exportExcel.fields,data:v.exportExcelData,type:v.exportExcel.type,name:v.exportExcel.filename},{default:r((()=>[p(V,{class:"uni-button",type:"primary",size:"mini"},{default:r((()=>[g("导出 Excel")])),_:1})])),_:1},8,["fields","data","type","name"]),p(V,{class:"uni-button",type:"primary",size:"mini",onClick:t[2]||(t[2]=t=>e.$refs.batchSms.open())},{default:r((()=>[g("群发短信")])),_:1})])),_:1})])),_:1}),p(F,{class:"uni-container"},{default:r((()=>[p(K,{ref:"udb",collection:"uni-id-tag",field:"tagid,name,description,create_date",where:v.where,"page-data":"replace",orderby:v.orderby,getcount:!0,"page-size":v.options.pageSize,"page-current":v.options.pageCurrent,options:v.options,loadtime:"manual",onLoad:T.onqueryload},{default:r((({data:e,pagination:a,loading:i,error:n,options:l})=>[p(N,{ref:"table",loading:i,emptyText:n.message||"没有更多数据",border:"",stripe:"",type:"selection",onSelectionChange:T.selectionChange},{default:r((()=>[p(P,null,{default:r((()=>[p(L,{align:"center","filter-type":"search",onFilterChange:t[3]||(t[3]=e=>T.filterChange(e,"tagid")),sortable:"",onSortChange:t[4]||(t[4]=e=>T.sortChange(e,"tagid"))},{default:r((()=>[g("标签的tagid")])),_:1}),p(L,{align:"center","filter-type":"search",onFilterChange:t[5]||(t[5]=e=>T.filterChange(e,"name")),sortable:"",onSortChange:t[6]||(t[6]=e=>T.sortChange(e,"name"))},{default:r((()=>[g("标签名称")])),_:1}),p(L,{align:"center","filter-type":"search",onFilterChange:t[7]||(t[7]=e=>T.filterChange(e,"description")),sortable:"",onSortChange:t[8]||(t[8]=e=>T.sortChange(e,"description"))},{default:r((()=>[g("标签描述")])),_:1}),p(L,{align:"center","filter-type":"timestamp",onFilterChange:t[9]||(t[9]=e=>T.filterChange(e,"create_date")),sortable:"",onSortChange:t[10]||(t[10]=e=>T.sortChange(e,"create_date"))},{default:r((()=>[g("创建时间")])),_:1}),p(L,{align:"center"},{default:r((()=>[g("操作")])),_:1})])),_:1}),(h(!0),m(b,null,f(e,((e,t)=>(h(),s(P,{key:t},{default:r((()=>[p(R,{align:"center"},{default:r((()=>[g(C(e.tagid),1)])),_:2},1024),p(R,{align:"center"},{default:r((()=>[p(U,{type:"primary",inverted:"",size:"small",text:e.name},null,8,["text"])])),_:2},1024),p(R,{align:"center"},{default:r((()=>[g(C(e.description),1)])),_:2},1024),p(R,{align:"center"},{default:r((()=>[p(B,{threshold:[0,0],date:e.create_date},null,8,["date"])])),_:2},1024),p(R,{align:"center"},{default:r((()=>[p(F,{class:"uni-group"},{default:r((()=>[p(V,{onClick:t=>T.navigateTo("../user/list?tagid="+e.tagid,!1),class:"uni-button",size:"mini",type:"primary"},{default:r((()=>[g("成员")])),_:2},1032,["onClick"]),p(V,{onClick:t=>T.navigateTo("./edit?id="+e._id,!1),class:"uni-button",size:"mini",type:"primary"},{default:r((()=>[g("修改")])),_:2},1032,["onClick"]),p(V,{onClick:t=>T.confirmDelete(e._id),class:"uni-button",size:"mini",type:"warn"},{default:r((()=>[g("删除")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1032,["loading","emptyText","onSelectionChange"]),p(F,{class:"uni-pagination-box"},{default:r((()=>[p(W,{"show-iconn":"","show-page-size":"","page-size":a.size,modelValue:a.current,"onUpdate:modelValue":e=>a.current=e,total:a.count,onChange:T.onPageChanged,onPageSizeChange:T.changeSize},null,8,["page-size","modelValue","onUpdate:modelValue","total","onChange","onPageSizeChange"])])),_:2},1024)])),_:1},8,["where","orderby","page-size","page-current","options","onLoad"])])),_:1}),p(O,{ref:"batchSms",toType:"userTags",receiver:T.smsReceiver},null,8,["receiver"])])),_:1})}]]);export{V as default};
