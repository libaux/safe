import{_ as e,A as a,aJ as l,B as t,Y as s,r as o,b as r,C as u,am as n,c as i,w as c,aN as d,i as p,o as m,l as g,m as y,T as v,p as f,D as b,t as x,F as w,q as k,x as h,v as _,aK as z,n as C,I as V,u as $,V as j}from"./index-CTufusbk.js";import{_ as T}from"./uni-stat-breadcrumb.hcid91PT.js";import{_ as F}from"./uni-tag.B323AB0c.js";import{_ as U}from"./uni-pagination.BD5KDJr5.js";const D="width:30px; text-align:center; font-weight: bold; font-size:10px;",M=e({__name:"log",setup(e){const M="background-color:#f7f3ff;border-color:#ad95e6;color:#ad95e6;",R="background-color:#ebf8ff;border-color:#78b2dd;color:#82beef;",S="background-color:#F0F9EB;border-color:#92c477;color:#92c477;",H="background-color:#fff8ec;border-color:#efc78f;color:#fab87b;",I="background-color:#fff5f7;border-color:#ff696b;color:#ff9c9e;",K="background-color:#ffffff;border-color:#C0C4CC;color:#C0C4CC;",A=a(!0),B=l((()=>(e=null)=>{const a={style:D,text:""};switch(e){case"first":a.style+=R,a.text+="固定";break;case"oftens":a.style+=S,a.text+="常用";break;case"random":a.style+=H,a.text+="随机";break;case"black":a.style+=R,a.text+="黑名";break;case"except":a.style+=H,a.text+="异常";break;case"fail":a.style+=I,a.text+="失败";break;case"error":a.style+=I,a.text+="错误";break;default:a.style+=K,a.text+="未知"}return a}));t((async()=>{await L()}));const E=s.database(),Y=a([]),q=a(0),J=a({}),L=async()=>{A.value=!0;const e=s.importObject("libauxAdmin",{customUI:!0}),a=await e.getUsersLog({taskTime:q.value,where:J.value,skip:N.value.size*(N.value.current-1),limit:N.value.size});N.value.count=a.count||0,Y.value=a.data,A.value=!1},N=a({size:20,current:1,count:0}),O=async e=>{N.value.current=e.current,await L(),ae.value?ee.value=Y.value.map((e=>e.mobile)):ee.value=[]},P=async e=>{N.value.size=e,N.value.current=1,await z((async()=>{await L()}))},G=a(0),Q=a(""),W=async()=>{Q.value=(e=>{const a=new Date(e);return`${a.getFullYear()}/${a.getMonth()+1}/${a.getDate()} ${a.getHours()<10?"0"+a.getHours():a.getHours()}:${a.getMinutes()<10?"0"+a.getMinutes():a.getMinutes()}`})(G.value),J.value.logs={taskTime:Q.value},await z((async()=>{await L()}))},X=a(""),Z=async()=>{const e=new RegExp(X.value,"i");J.value=E.command.or(["mobile","school"].map((a=>({[a]:e})))),await z((async()=>{await L()}))},ee=a([]),ae=a(!1),le=e=>{e.detail.value?(ee.value=Y.value.map((e=>e.mobile)),ae.value=!0):(ee.value=[],ae.value=!1)},te=e=>{ee.value=[e.mobile]},se=e=>{C({url:e})};return(e,a)=>{const l=o(r("uni-stat-breadcrumb"),T),t=o(r("uni-datetime-picker"),d),s=p,z=V,C=$,R=j,S=u("el-button"),H=u("el-table-column"),I=o(r("uni-tag"),F),K=u("el-table"),E=o(r("uni-pagination"),U),q=n("loading");return m(),i(s,null,{default:c((()=>[g(s,{class:"uni-header"},{default:c((()=>[g(l,{class:"uni-stat-breadcrumb-on-phone"}),g(s,{class:"uni-group"},{default:c((()=>[g(s,{class:"example-body",style:{margin:"10px"}},{default:c((()=>[g(t,{type:"datetime","hide-second":"",returnType:"string",modelValue:G.value,"onUpdate:modelValue":a[0]||(a[0]=e=>G.value=e),onChange:W,"clear-icon":!0},null,8,["modelValue"])])),_:1}),g(z,{class:"uni-search",style:{height:"33px",margin:"10px"},type:"text",modelValue:X.value,"onUpdate:modelValue":a[1]||(a[1]=e=>X.value=e),onConfirm:Z,placeholder:"请输入搜索内容"},null,8,["modelValue"]),g(C,{class:"uni-btton hide-on-phone",style:{margin:"5px 0 5px 0"},type:"primary",size:"mini",plain:"",onClick:Z},{default:c((()=>[y("搜索")])),_:1})])),_:1})])),_:1}),g(s,{class:"uni-container"},{default:c((()=>[v((m(),i(K,{data:Y.value,onRowClick:te,"row-key":"mobile","expand-row-keys":ee.value,border:!1,stripe:"",style:{width:"100%"}},{default:c((()=>[g(H,{type:"expand"},{header:c((()=>[g(R,{checked:ae.value,onChange:le,style:{transform:"scale(0.7)","transform-origin":"-15px"}},null,8,["checked"])])),default:c((e=>[g(s,{style:{display:"grid","grid-template-columns":"auto 138px"}},{default:c((()=>[g(s,{style:{"margin-left":"60px"}},{default:c((()=>[e.row.logs?(m(),f("div",{key:0},[b("h3",null,x(e.row.logs.title),1),(m(!0),f(w,null,k(e.row.logs.content,((e,a)=>(m(),f("p",{key:a},[b("p",null,x("["+e.timeStr+"]  "+e.msg),1)])))),128)),b("p",null,"任务类型: "+x(e.row.logs.taskType)+" "+x(e.row.logs.status),1)])):h("",!0)])),_:2},1024),g(s,{style:{"margin-top":"5px",display:"grid","grid-template-rows":"25px 25px",gap:"11px"}},{default:c((()=>[g(S,{onClick:a=>se(`/pages/system/user/detail?id=${e.row.uid}&school=${e.row.school}&mobile=${e.row.mobile}`),type:"primary",size:"small",plain:""},{default:c((()=>[y("详情 ")])),_:2},1032,["onClick"]),g(S,{onClick:a=>se(`/pages/system/user/edit?id=${e.row.uid}`),style:{margin:"0"},color:"#D08F6C",size:"small",plain:""},{default:c((()=>[y("会员 ")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:1}),g(H,{prop:"logs.taskTime",label:"任务时间",width:"180"}),g(H,{prop:"mobile",label:"用户手机",width:"150"}),g(H,{prop:"logs.title",label:"最新日志","min-width":"300"}),g(H,{prop:"school",label:"学校",width:"200"}),g(H,{label:"状态",width:"150"},{default:c((e=>[g(s,{style:{display:"grid","justify-content":"start","grid-template-columns":"auto auto","grid-gap":"10px"}},{default:c((()=>{var a,l,t,s,o;return["success"==(null==(a=e.row.logs)?void 0:a.status)?(m(),i(I,{key:0,size:"small",inverted:"",style:_(B.value(e.row.logs.successKind).style),text:B.value(e.row.logs.successKind).text},null,8,["style","text"])):"except"==(null==(l=e.row.logs)?void 0:l.status)?(m(),i(I,{key:1,size:"small",inverted:"",style:_(B.value("except").style),text:B.value("except").text},null,8,["style","text"])):"fail"==(null==(t=e.row.logs)?void 0:t.status)?(m(),i(I,{key:2,size:"small",inverted:"",style:_(B.value("fail").style),text:B.value("fail").text},null,8,["style","text"])):"error"==(null==(s=e.row.logs)?void 0:s.status)?(m(),i(I,{key:3,size:"small",inverted:"",style:_(B.value("error").style),text:B.value("error").text},null,8,["style","text"])):(m(),i(I,{key:4,size:"small",inverted:"",style:_(B.value().style),text:B.value().text},null,8,["style","text"])),(null==(o=e.row.logs)?void 0:o.pushed)?(m(),i(I,{key:5,size:"small",inverted:"",style:_(D+M),text:"push"},null,8,["style"])):h("",!0)]})),_:2},1024)])),_:1})])),_:1},8,["data","expand-row-keys"])),[[q,A.value]]),g(s,{class:"uni-pagination-box"},{default:c((()=>[g(E,{"show-iconn":"","show-page-size":"",pageSizeRange:[20,100,1e3],onChange:O,onPageSizeChange:P,modelValue:N.value.current,"onUpdate:modelValue":a[2]||(a[2]=e=>N.value.current=e),"page-size":N.value.size,total:N.value.count},null,8,["pageSizeRange","modelValue","page-size","total"])])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-bb7e3e14"]]);export{M as default};
